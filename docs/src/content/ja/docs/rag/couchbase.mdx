---
title: "Couchbase | RAG | Mastra Docs"
description: MastraのRAGシステムでCouchbaseを使用する方法を学びます。
---

# Couchbase

Couchbaseは、ベクトル検索機能を備えた分散型NoSQLデータベースです。Mastraは、Couchbaseを使用してベクトル埋め込みを保存し、類似性検索を実行するための統合を提供します。

## インストール

```bash
npm install @mastra/couchbase
```

## 使用方法

### 初期化

```typescript
import { CouchbaseVector } from '@mastra/couchbase';

const couchbase = new CouchbaseVector({
  connectionString: process.env.COUCHBASE_CONNECTION_STRING,
  username: process.env.COUCHBASE_USERNAME,
  password: process.env.COUCHBASE_PASSWORD,
  bucketName: process.env.COUCHBASE_BUCKET,
});
```

### インデックスの作成

```typescript
await couchbase.createIndex({
  indexName: 'test_collection',
  dimension: 1536, // 埋め込みの次元数
});
```

### 埋め込みの保存

```typescript
await couchbase.upsert({
  indexName: 'test_collection',
  vectors: embeddings,
  metadata: chunks?.map(chunk => ({ text: chunk.text })),
});
```

### 類似性検索

```typescript
const results = await couchbase.similaritySearch({
  indexName: 'test_collection',
  query: '検索クエリ',
  k: 5, // 返す結果の数
});
```

## メソッド

### `createIndex`

新しいベクトルインデックスを作成します。

```typescript
createIndex({
  indexName: string;
  dimension: number;
}): Promise<void>;
```

### `upsert`

ベクトル埋め込みとメタデータを保存します。

```typescript
upsert({
  indexName: string;
  vectors: number[][];
  metadata?: Record<string, any>[];
}): Promise<void>;
```

### `similaritySearch`

類似性検索を実行します。

```typescript
similaritySearch({
  indexName: string;
  query: string;
  k?: number;
}): Promise<{
  text: string;
  metadata: Record<string, any>;
  score: number;
}[]>;
```

## 注意事項

1. Couchbaseのベクトル検索機能は、Couchbase Server 7.2以降で利用可能です。
2. メタデータフィルターは現在サポートされていません。
3. インデックスの作成には、適切な権限が必要です。
4. 大量のデータを扱う場合は、バッチ処理を検討してください。

## ベストプラクティス

1. インデックス名は一意で、アプリケーション内で一貫して使用してください。
2. 埋め込みの次元数は、使用するモデルに合わせて設定してください。
3. メタデータは、検索やフィルタリングに必要な情報のみを含めてください。
4. 定期的にインデックスの最適化を実行してください。 